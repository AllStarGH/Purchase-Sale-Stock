<!DOCTYPE html>
<html>

<!-- jquery -->
<script src="../../../jquery/jquery-3.2.1.min.js"></script>

<!-- JavaScript 点击链接切换division  -->
<script type="text/javascript"
	src="../../../jquery/OwnJavaScript/ClickSwitchDivision.js"></script>

<!-- bootstrap CSS -->
<link rel="stylesheet" type="text/css"
	href="../../../CssFrame/bootstrap.css"></link>
<link rel="stylesheet" type="text/css"
	href="../../../CssFrame/bootstrap-theme.css"></link>

<!-- jquery ui js -->
<script src="../../../jquery-ui-1.12.1/jquery-ui.js"></script>
<script src="../../../jquery-ui-1.12.1/jquery-ui.min.js"></script>
<script src="../../../jquery-ui-1.12.1/external/jquery/jquery.js"></script>

<!-- jquery ui css -->
<link rel="stylesheet" type="text/css"
	href="../../../jquery-ui-1.12.1/jquery-ui.css"></link>
<link rel="stylesheet" type="text/css"
	href="../../../jquery-ui-1.12.1/jquery-ui.min.css"></link>
<link rel="stylesheet" type="text/css"
	href="../../../jquery-ui-1.12.1/jquery-ui.structure.css"></link>
<link rel="stylesheet" type="text/css"
	href="../../../jquery-ui-1.12.1/jquery-ui.structure.min.css"></link>
<link rel="stylesheet" type="text/css"
	href="../../../jquery-ui-1.12.1/jquery-ui.theme.css"></link>
<link rel="stylesheet" type="text/css"
	href="../../../jquery-ui-1.12.1/jquery-ui.theme.min.css"></link>

<!-- layui javascript -->
<script src="../../../CssFrame/layui/layui.js"></script>
<script src="../../../CssFrame/layui/layui.all.js"></script>
<script src="../../../CssFrame/layui/lay/modules/layer.js"></script>

<!-- layui css -->
<link rel="stylesheet" type="text/css"
	href="../../../CssFrame/layui/css/layui.css"></link>
<link rel="stylesheet" type="text/css"
	href="../../../CssFrame/layui/css/modules/layer/default/layer.css"></link>
<link rel="stylesheet" type="text/css"
	href="../../../CssFrame/layui/css/modules/code.css"></link>
<link rel="stylesheet" type="text/css"
	href="../../../CssFrame/layui/css/modules/laydate/default/laydate.css"></link>

<head>
<meta charset="UTF-8">
<title>填写销售记录</title>
</head>

<style type="text/css" media="screen">
.form-bottom>form:nth-child(1) {
	margin: 72px auto 190px auto;
	font-size: 22px;
}

.form-group {
	margin: auto auto 2em auto;
}

.submit {
	margin-left: 50%;
}

.head_title {
	margin: 88px 0 0 0;
}

select {
	width: 35rem;
}

.inner-bg {
	background: beige;
}

.form-bottom form input {
	height: 45px;
}
</style>

<body>
	<div class="top-content">

		<div class="inner-bg">
			<div class="container">

				<div style="text-align: center;" class="head_title">
					<h2>填写销售记录单</h2>
				</div>
				<div class="form-bottom contact-form">

					<form role="form" class="saler_form">

						<div class="form-group">
							<span>耗资金额</span>
							<!-- 非零正数,最多2位小数 -->
							<input type="text" name="amountMoney"
								class="amountMoney contact-email form-control" maxlength="16">
						</div>

						<div class="form-group">
							<span>已付款金额</span>

							<p style="color: rgb(223, 31, 31)"></p>

							<!-- 非零正数,最多2位小数 -->
							<input type="text" name="amountPaid"
								class="amountPaid contact-email form-control" maxlength="16"
								onblur="setIsPay()">
						</div>

						<div class="form-group">
							<span>存货类型</span> <select class="classify_store" onchange="">
								<option value="0">电器</option>
								<option value="1">食品</option>
								<option value="2">服装</option>
								<option value="3">日用品</option>
								<option value="4">饮品</option>
								<option value="5">其它</option>
								<option value="6">家具</option>
								<option value="7">玩具</option>
								<option value="8">药品</option>
								<option value="9">尚未具体分类</option>
							</select>
						</div>

						<div class="form-group">
							<span>货物名称</span> <select name="commodity" onchange="">

							</select>
						</div>

						<!-- 自动赋值 -->
						<div class="form-group">
							<span>客户是否已付款(付款情况)</span> <input type="text"
								class="contact-email form-control is_pay" readonly="readonly">

							<input type="text" name="isPay"
								class="contact-email form-control isPay" style="display: none;">
						</div>

						<div class="form-group">
							<span>付款方式</span> <select name="paymentMethod">
								<option value="0">现金</option>
								<option value="1">网银</option>
								<option value="2">信用卡</option>
								<option value="3">其它</option>
							</select>
						</div>

						<div class="form-group">
							<span>销售数量</span>

							<!-- 正整数 -->
							<input type="text" name="quantity"
								class="quantity contact-email form-control" maxlength="11">
						</div>

						<div class="form-group">
							<span>客户名</span> <input type="text" name="customer"
								class="contact-email form-control customer" maxlength="44">
						</div>

						<!-- 自动赋值 -->
						<div class="form-group">
							<span>存货是否足够</span> <input type="text" name="isEnoughStock"
								class="contact-email form-control" readonly="readonly">
						</div>

						<div class="form-group">
							<span>销售分部所属地</span> <select name="regionDepartment">
								<option value="0">滨河</option>
								<option value="1">上天院</option>
								<option value="2">鸣皋</option>
								<option value="3">焦王</option>
								<option value="4">申坡</option>
								<option value="5">遵王</option>
								<option value="6">常海山</option>
								<option value="7">老君堂</option>
								<option value="8">鸦岭</option>
								<option value="9">酒后</option>
								<option value="10">平等</option>
								<option value="11">夏堡</option>
								<option value="12">富留店</option>
							</select>
						</div>

						<div class="form-group">
							<button type="button" class="btn btn-lg btn-primary submit"
								onclick="prevent()">提交</button>
						</div>

					</form>
				</div>

			</div>
		</div>
	</div>
</body>

<script type="text/javascript">
	/**
	 * 给"付款情况"赋值
	 */
	function setIsPay() {
		var money = $('.amountMoney').val();
		var paid = $('.amountPaid').val();

		// if (regular() == false) {
		// 	return;
		// } else 
		if (compare() == true) {
			return;

		}

		var percent = paid / money;
		console.log(percent);

		//0未,1已付定金,2多于定金少于全款,3已全款付完
		var hint = '';
		var isPay = null;

		if (percent == 0) {
			hint = '未付款';
			isPay = 0;

		} else if (percent > 0 && percent < 0.5) {
			hint = '已付定金';
			isPay = 1;

		} else if (percent > 0.5 && percent < 1) {
			hint = '多于定金少于全款';
			isPay = 2;

		} else if (percent == 1) {
			hint = '已全款付完';
			isPay = 3;

		}

		console.log(hint + ',' + isPay);

		$('.isPay').val(isPay);
		$('.is_pay').val(hint);

	}

	/**
	 * 预防
	 * @return {[type]} [description]
	 */
	function prevent() {
		var customer = $('.customer').val();
		console.log(customer);


		if (regular() == false) {
			return;

		} else if (compare() == true) {
			return;

		}

		switch(customer.trim()){
			case null:
			alert('客户名未填入');
			return;
			break;

			case '':
			alert('客户名未填入');
			return;
			break;

			default:
			console.log('ok');
			break;

		}

		sendData();
	}

	/**
	 * 发送数据
	 * @return {[type]} [description]
	 */
	function sendData() {
		var data = $('.saler_form').serialize();
		console.log(data);
	}

	/**
	 * 正则规范
	 * @return {[type]} [description]
	 */
	function regular() {
		var bool = null;

		//小数点后允许最多带2位小数
		var exp1 = new RegExp(/^(([1-9]{1}\d*)|(0{1}))(\.\d{0,2})?$/);

		//正整数
		var exp2 = new RegExp(/^[0-9]*[1-9][0-9]*$/);

		var money = $('.amountMoney').val();
		var paid = $('.amountPaid').val();
		var quantity = $('.quantity').val();

		if (money <= 0 || quantity <= 0 && paid < 0) {
			alert('输入的数字不能小于等于零(已付款额除外)');

			bool = false;

		} else if (exp1.test(money) == false || exp1.test(paid) == false) {
			$('.amountPaid').css('background', 'rgb(227, 178, 178)');
			$('.amountMoney').css('background', 'rgb(227, 178, 178)');

			alert('在总金额或已付款额之处输入的数字不合规');
			bool = false;

		} else if (exp2.test(quantity) == false) {
			$('.quantity').css('background', 'rgb(227, 178, 178)');

			alert('数量必须是正整数');
			bool = false;
		}

		return bool;
	}

	/**
	 * 比较大小
	 * @return {[type]} [description]
	 */
	function compare() {
		var boo = null;

		var money = $('.amountMoney').val();
		var paid = $('.amountPaid').val();

		if (money != null && money != '' && paid != '' && paid != null) {

			boo = paid * 100 > money * 100;

			console.log('boo:' + boo);
			if (boo) {
				$('.amountPaid').css('background', 'rgb(227, 178, 178)');
				$('.amountPaid').prev('p').text('已付款金额不能大于总金额');

				alert('已付款金额不能大于总金额');
			}
		}

		return boo;
	}
</script>
</html>